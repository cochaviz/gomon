# gomon

Detect interesting network activity generated by sandboxed bots or malware samples. gomon ingests live interfaces or PCAP captures, groups traffic into time windows, and logs alerts when configured thresholds are exceeded.

## Features

- Sliding time window analysis with configurable duration.
- Packet-rate and destination endpoint (IP/port/protocol) diversity thresholds for pinpointing suspicious bursts or scans.
- Suricata Eve-compatible logging to stdout or a JSON file, enriched with gomon metadata (sample IDs, C2 indicators, and rate metrics).
- End-of-run summary detailing alert counts, idle windows, and saved packet captures.
- Signal handling to gracefully stop live captures.
- Destination tracking is limited to a bounded set per window (defaults to 1024 endpoints) to keep processing predictable.

## Usage

```bash
gomon <input> <src_ip> [flags]
```

- `<input>`: Interface name for live capture or path to a `.pcap` file.
- `<src_ip>`: IP address assigned to the sandboxed bot under observation.

### Common Flags

| Flag | Description | Default |
|------|-------------|---------|
| `--eve-log-path` | Eve JSON log file path (stdout if omitted). | _None_ |
| `--window` | Analysis window size in seconds. | `30` |
| `--packet-threshold` | Packets per window that trigger an alert. | `5` |
| `--ip-threshold` | Unique destination endpoints (IP/port/protocol) per window that trigger a scan alert. | `10` |
| `--log-level` | Logging verbosity (`debug`, `info`, `warn`, `error`). | `info` |
| `--save-packets` | Number of most recent packets per host to persist when an alert fires. | `0` |
| `--show-idle` | Emit idle window records instead of alerts only. | `false` |
| `--capture-dir` | Directory for packet captures created when alerts fire. Defaults to `./captures`. | `./captures` |
| _internal_ | Up to 1024 unique destinations (IP/port/protocol) are tracked per window to cap resource use. | `1024` |

## Alert Semantics

Each window is logged using Suricata's Eve schema (`event_type=stats` for idle windows, `event_type=alert` for detections). Every record includes compatible fields plus a `metadata.gomon` block containing gomon-specific context. Core alert fields still include:

- `@timestamp`: Start of the window that triggered the alert.
- `src_ip`: Sandbox source.
- `dst_ips`: Unique destinations contacted in the window, keyed by IP, port, and protocol.
- Threshold values and measured rates (also mirrored under `metadata.gomon`) to aid triage.

## Development

Run the Go module tests with:

```bash
go test ./...
```

Set the `--log-level` flag to `debug` for deeper insight into window handling and packet flow while developing or troubleshooting.
